@page "/test-table-grid"
@rendermode InteractiveServer
@* 
@using Blazor.Tools.BlazorBundler.Entities
@using Blazor.Tools.BlazorBundler.Interfaces
@using Blazor.Tools.BlazorBundler.Components.Grid
@using Bogus
@using System.Data

@inject NavigationManager Navigation

<PageTitle>Test Table Grid</PageTitle>

<h1>Testing Sample Table Grid Component</h1>
<TableGrid Title="Employees" AllowCellSelection="true">
    <TableSource Name="EmployeeDS" DataSource="@_employees" />
    <TableSource Name="CountryDS" DataSource="@_countries" />
    <TableNode DataSource="EmployeeDS">
        <TableColumn DataSourceName="EmployeeDS" FieldName="ID" Type="TextBox" Visible="false" />
        <TableColumn DataSourceName="EmployeeDS" FieldName="FirstName" Type="TextBox" HeaderName="First Name" />
        <TableColumn DataSourceName="EmployeeDS" FieldName="MiddleName" Type="TextBox" HeaderName="Middle Name" />
        <TableColumn DataSourceName="EmployeeDS" FieldName="LastName" Type="TextBox" HeaderName="Last Name" />
        <TableColumn DataSourceName="CountryDS" FieldName="CountryID" Type="DropdownList" DisplayFieldName="Name" DisplayFieldValue="ID" HeaderName="Country" />
    </TableNode>
</TableGrid>

<TableGrid 
    Title="Countries" 
    DataTable="@_countries" 
    HiddenColumnNames="@_hiddenCountryColumns" 
    HeaderNames="@_countryHeaderNames" 
    />

@code {

    [Inject] public ISessionTableService _sessionTableService { get; set; } = default!;

    private DataTable _employees = default!;
    private DataTable _countries = default!;
    private List<string>? _hiddenCountryColumns;
    private Dictionary<string, string>? _employeeHeaderNames;
    private Dictionary<string, string>? _countryHeaderNames;
    

    protected override void OnParametersSet()
    {
        Console.WriteLine("TestTableGrid OnParametersSetAsync");
        SessionManager.GetInstance(_sessionTableService);
        // Initialize _employees DataTable

        _employeeHeaderNames = new Dictionary<string, string>()
        {
            ["ID"] = "ID",
            ["FirstName"] = "First Name",
            ["MiddleName"] = "Middle Name",
            ["LastName"] = "Last Name",
            ["CountryID"] = "Country",
        };

        _employees = new DataTable("Employee");
        _employees.Columns.Add("ID", typeof(int));
        _employees.Columns.Add("FirstName", typeof(string));
        _employees.Columns.Add("MiddleName", typeof(string));
        _employees.Columns.Add("LastName", typeof(string));
        _employees.Columns.Add("CountryID", typeof(int));

        var employeeFaker = new Faker<Employee>()
           .RuleFor(e => e.ID, f => f.IndexFaker + 1)
           .RuleFor(e => e.FirstName, f => f.Name.FirstName())
           .RuleFor(e => e.MiddleName, f => f.Name.FirstName().Substring(0, 1) + ".")
           .RuleFor(e => e.LastName, f => f.Name.LastName())
           .RuleFor(e => e.CountryID, f => f.Random.Int(1, 2));

        var countryFaker = new Faker<Country>()
        .RuleFor(c => c.ID, f => f.IndexFaker + 1)
        .RuleFor(c => c.Name, f => f.Address.Country());

        for (int i = 0; i < 101; i++)
        {
            var employee = employeeFaker.Generate();
            _employees.Rows.Add(i + 1, employee.FirstName, employee.MiddleName, employee.LastName, employee.CountryID);
        }

        // Initialize and generate country data
        _countryHeaderNames = new Dictionary<string, string>()
        {
            ["ID"] = "ID",
            ["Name"] = "Country Name",
        };

        _countries = new DataTable("Country");
        _countries.Columns.Add("ID", typeof(int));
        _countries.Columns.Add("Name", typeof(string));

        for (int i = 0; i < 101; i++)
        {
            var country = countryFaker.Generate();
            _countries.Rows.Add(i+ 1, country.Name);
        }

        _hiddenCountryColumns = new List<string>();
        _hiddenCountryColumns.Add("ID");
    }

    public class Employee
    {
        public int ID { get; set; }
        public string FirstName { get; set; } = default!;
        public string MiddleName { get; set; } = default!;
        public string LastName { get; set; } = default!;
        public int CountryID { get; set; } 
    }

    public class Country
    {
        public int ID { get; set; }
        public string Name { get; set; } = default!;
    }

} *@
