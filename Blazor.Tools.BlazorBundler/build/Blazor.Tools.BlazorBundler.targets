<Project>
  <PropertyGroup>
    <TargetProjectPath>$(MSBuildProjectFullPath)</TargetProjectPath>
  </PropertyGroup>
  <Target Name="CustomInstall" BeforeTargets="PrepareForBuild">
    <!-- Log some information for debugging -->
    <Message Text="Executing CustomInstall target" Importance="high" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\blazor-bootstrap\blazor.bootstrap.css')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\blazor-bootstrap\blazor.bootstrap.css"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\blazor-bootstrap\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\blazor-bootstrap\blazor.bootstrap.js')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\blazor-bootstrap\blazor.bootstrap.js"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\blazor-bootstrap\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\blazored-typeahead\blazored-typeahead.js')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\blazored-typeahead\blazored-typeahead.js"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\blazored-typeahead\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\bootstrap-icons\font\bootstrap-icons.min.css')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\bootstrap-icons\font\bootstrap-icons.min.css"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\bootstrap-icons\font\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\bootstrap-icons\font\fonts\bootstrap-icons.woff')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\bootstrap-icons\font\fonts\bootstrap-icons.woff"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\bootstrap-icons\font\fonts\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\bootstrap-icons\font\fonts\bootstrap-icons.woff2')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\bootstrap-icons\font\fonts\bootstrap-icons.woff2"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\bootstrap-icons\font\fonts\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\js\bootstrap.bundle.min.js')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\js\bootstrap.bundle.min.js"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\js\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\wwwroot\js\site.js')"
          SourceFiles="$(MSBuildThisFileDirectory)..\wwwroot\js\site.js"
          DestinationFolder="$(MSBuildProjectDirectory)\wwwroot\js\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\tools\Uninstall.ps1')"
          SourceFiles="$(MSBuildThisFileDirectory)..\tools\Uninstall.ps1"
          DestinationFolder="$(MSBuildProjectDirectory)\BlazorBundler\" />

    <Copy Condition="!Exists('$(MSBuildProjectDirectory)\README.md')"
          SourceFiles="$(MSBuildThisFileDirectory)..\README.md"
          DestinationFolder="$(MSBuildProjectDirectory)\BlazorBundler\" />

    <ItemGroup>
      <PackageReferenceToUpdate Include="Blazor.Bootstrap" Version="1.11.1" />
      <PackageReferenceToUpdate Include="Blazor.Typeahead" Version="4.7.0" />
    </ItemGroup>

    <!-- Update the Blazor.Bootstrap package reference using findstr -->
    <Exec Command="dotnet list $(TargetProjectPath) package Blazor.Bootstrap | findstr /C:&quot;1.11.1=&quot;" />
    <Exec Command="if %errorlevel% neq 0 dotnet add $(TargetProjectPath) package Blazor.Bootstrap --version 1.11.1" />
    <!-- Blazor.Bootstrap successful update -->
    <Message Text="Updated Blazor.Bootstrap to version 1.11.1 in $(TargetProjectPath)" Importance="high" />

    <!-- Update the Blazored.Typeahead package reference using findstr -->
    <Exec Command="dotnet list $(TargetProjectPath) package Blazored.Typeahead | findstr /C:&quot;4.7.0=&quot;" />
    <Exec Command="if %errorlevel% neq 0 dotnet add $(TargetProjectPath) package Blazored.Typeahead --version 4.7.0" />
    <!-- Blazored.Typeahead successful update -->
    <Message Text="Updated Blazored.Typeahead to version 4.7.0 in $(TargetProjectPath)" Importance="high" />
    
  </Target>
</Project>
